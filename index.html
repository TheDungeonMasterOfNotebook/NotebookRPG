<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>epictextrpg â€” Echoes of the Forgotten (Phase 11)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Seed overlay / start screen -->
  <div id="seedOverlay" class="seed-overlay" role="dialog" aria-modal="true">
    <div class="seed-card">
      <h2>epictextrpg â€” Echoes of the Forgotten</h2>
      <p class="muted">Enter a seed (shareable) or pick Random / Daily. Choose a class to begin Season 1.</p>
      <input id="seedInput" type="text" inputmode="numeric" placeholder="Enter seed or leave blank" />
      <div style="margin-top:8px;">
        <select id="classSelect" aria-label="Choose class">
          <option value="Warrior">Warrior</option>
          <option value="Mage">Mage</option>
          <option value="Rogue">Rogue</option>
        </select>
      </div>
      <div class="seed-controls">
        <button id="btnStartSeed" class="accent">Begin Run</button>
        <button id="btnRandomSeed" class="secondary">Random Seed</button>
        <button id="btnDailySeed" class="secondary">Today's Challenge</button>
      </div>
      <div class="small muted" style="margin-top:8px">Seed appears top-right after start â€” copy/share to replay exact dungeon.</div>
    </div>
  </div>

  <div id="app" class="wrap" aria-hidden="true">
    <header class="topbar">
      <div>
        <h1 id="gameTitle">epictextrpg</h1>
        <div class="subtitle">Echoes of the Forgotten â€” Season 1 (Phase 11)</div>
      </div>
      <div class="top-actions">
        <div class="small muted">Seed: <span id="seedDisplay">â€”</span></div>
        <div class="small muted">Legacy: <span id="legacyPts">0</span></div>
        <button id="btnLibrary" class="secondary">Library</button>
        <button id="btnCustomize" class="secondary">Titles & Styles</button>
        <button id="btnMeta" class="secondary">Shrine</button>
        <button id="btnNew" class="secondary">New Run</button>
        <button id="btnDaily" class="secondary">Daily Run</button>
        <button id="btnCredits" class="secondary">Credits</button>
        <button id="btnReset" class="warn">Reset Save</button>
      </div>
    </header>

    <main class="layout">
      <aside class="panel left">
        <section class="panel-block">
          <div class="section-title">Player</div>
          <div id="playerCard" class="player-card">
            <div id="playerName" class="player-name">â€”</div>
            <div id="playerClass" class="small muted">Choose a class</div>
            <div class="small muted" id="playerTitle">Title: â€”</div>
            <div class="equip-list muted">
              <div>Weapon: <span id="slotWeapon">None</span></div>
              <div>Armor: <span id="slotArmor">None</span></div>
              <div>Accessory: <span id="slotAccessory">None</span></div>
            </div>
            <div class="relic-row small muted" id="relicRow">Relics: â€”</div>
          </div>
        </section>

        <section class="panel-block">
          <div class="section-title">Stats</div>
          <div class="stats-grid">
            <div class="stat">HP <span id="hp">0</span>/<span id="maxhp">0</span></div>
            <div class="stat">MP <span id="mp">0</span>/<span id="maxmp">0</span></div>
            <div class="stat">ATK <span id="atk">0</span></div>
            <div class="stat">DEF <span id="def">0</span></div>
            <div class="stat">MAG <span id="mag">0</span></div>
            <div class="stat">Floor <span id="floor">0</span></div>
            <div class="stat">Gold <span id="gold">0</span></div>
            <div class="stat">XP <span id="xp">0</span></div>
          </div>
        </section>

        <section class="panel-block">
          <div class="section-title">Mind</div>
          <div class="sanity-wrap">
            <div class="small muted">Sanity</div>
            <div class="sanity-bar" id="sanityBar" title="100">
              <div class="sanity-fill" id="sanityFill" style="width:100%"></div>
              <div class="sanity-label" id="sanityLabel">Stable</div>
            </div>
            <div class="small muted" id="sanityHint">Clear thoughts.</div>
          </div>
          <div style="margin-top:8px"><button id="btnDreamHub" class="secondary">Enter Dreamscape</button></div>
        </section>

        <section class="panel-block">
          <div class="section-title">Quick</div>
          <div class="controls">
            <button id="btnEnterRoom">Enter Node</button>
            <button id="btnShop">Shop</button>
            <button id="btnRest" class="secondary">Rest (5g)</button>
            <button id="btnInventory" class="secondary">Inventory</button>
            <button id="btnJournal" class="secondary">Journal</button>
            <button id="btnAchievements" class="secondary">Book of Deeds</button>
          </div>
        </section>

        <section class="panel-block">
          <div class="small muted">Inventory summary</div>
          <div class="small" id="invSummary">Potions: 0 â€¢ Ethers: 0 â€¢ Items: 0</div>
          <div style="margin-top:8px"><button id="btnExport" class="secondary">Export Log</button></div>
        </section>
      </aside>

      <section class="panel right">
        <div class="panel-block">
          <div class="section-title">Encounter</div>
          <div id="encounterBox" class="encounter">
            <div id="encounterTop" class="encounter-top">
              <div id="battleArea" class="battle-area"></div>
              <div id="encounterTitle" class="encounter-title">Welcome</div>
            </div>
            <div id="encounterText" class="muted">Start a run or choose a class.</div>

            <div id="combatUI" class="combat-ui hidden">
              <div class="enemy-panel">
                <div id="enemyName" class="enemy-name">â€”</div>
                <div class="small muted">HP: <span id="enemyHP">0</span> â€¢ ATK: <span id="enemyATK">0</span></div>
                <div class="small muted">Status: <span id="enemyStatus">â€”</span></div>
                <div id="enemyIntent" class="small muted">Intent: â€”</div>
              </div>

              <div class="combat-actions">
                <button id="btnAttack">Attack</button>
                <button id="btnSkill" class="secondary">Skill</button>
                <button id="btnSpell" class="secondary">Spell</button>
                <button id="btnItem" class="secondary">Item</button>
                <button id="btnRun" class="warn">Run</button>
              </div>

              <div id="skillMenu" class="spell-menu hidden"><div class="small muted">Skills</div><div id="skillRow" class="spell-row"></div><div style="margin-top:8px"><button id="btnSkillBack" class="secondary">Back</button></div></div>

              <div id="spellMenu" class="spell-menu hidden"><div class="small muted">Spells (MP)</div><div class="spell-row" id="spellRow"></div><div style="margin-top:8px"><button id="btnSpellBack" class="secondary">Back</button></div></div>
            </div>
          </div>
        </div>

        <div class="panel-block">
          <div class="section-title">Shop / Events / Town</div>
          <div id="shopPanel" class="shop-panel muted">Merchants, events and nodes appear here.</div>
        </div>

        <div class="panel-block">
          <div class="section-title">Log</div>
          <div id="log" class="log" aria-live="polite"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Save toast -->
  <div id="saveToast" class="save-toast">ðŸ’¾ Saved</div>

  <!-- Level-up modal -->
  <div id="levelModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3 id="levelTitle">Level Up!</h3>
      <div id="levelDesc" class="modal-body small muted">Choose your reward</div>
      <div class="modal-body" id="levelChoices" style="display:flex;gap:8px;justify-content:center"></div>
      <div class="modal-actions"><button id="levelClose" class="secondary">Close</button></div>
    </div>
  </div>

  <!-- Dream / Memory modal -->
  <div id="dreamModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3 id="dreamTitle">Dream</h3>
      <div class="modal-body" id="dreamBody" style="font-family: ui-monospace, monospace; white-space:pre-wrap;"></div>
      <div id="dreamChoices" class="modal-actions" style="justify-content:flex-start"></div>
      <div class="modal-actions"><button onclick="closeDream()" class="secondary">Close</button></div>
    </div>
  </div>

  <!-- Dreamscape hub -->
  <div id="dreamHubModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Dreamscape â€” Echoes</h3>
      <div id="dreamHubBody" class="modal-body">
        <div class="small muted">The dreamshroud resonates with your past. Choose:</div>
        <div style="margin-top:8px">
          <div class="item-row"><div><strong>The Echoing Merchant</strong><div class="small muted">Exchange sanity for rare relics</div></div><div><button class="secondary" onclick="dreamHubMerchant()">Visit</button></div></div>
          <div class="item-row"><div><strong>The Mirror of Factions</strong><div class="small muted">View and change your alignment (cost)</div></div><div><button class="secondary" onclick="dreamHubFaction()">View</button></div></div>
          <div class="item-row"><div><strong>Seek an Echo</strong><div class="small muted">Spend fragments for a powerful choice</div></div><div><button class="secondary" onclick="dreamHubEcho()">Seek</button></div></div>
        </div>
      </div>
      <div class="modal-actions"><button onclick="closeDreamHub()" class="secondary">Leave Dreamscape</button></div>
    </div>
  </div>

  <!-- Library -->
  <div id="libraryModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Library of Shadows</h3>
      <div id="libraryContent" class="modal-body"></div>
      <div class="modal-actions"><button onclick="closeLibrary()" class="secondary">Close</button></div>
    </div>
  </div>

  <!-- Customization -->
  <div id="customModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Titles & Styles</h3>
      <div id="customContent" class="modal-body"></div>
      <div class="modal-actions"><button onclick="closeCustomize()" class="secondary">Close</button></div>
    </div>
  </div>

  <!-- Journal / lore -->
  <div id="journalModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Journal & Lore</h3>
      <div id="journalContent" class="modal-body"></div>
      <div class="modal-actions"><button onclick="closeJournal()" class="secondary">Close</button></div>
    </div>
  </div>

  <!-- Meta / Achievements / Credits -->
  <div id="metaModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>The Shrine of Memory</h3>
      <div id="metaContent" class="modal-body"></div>
      <div class="modal-actions"><button onclick="closeMeta()" class="secondary">Close</button></div>
    </div>
  </div>

  <div id="achievementsModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Book of Deeds</h3>
      <div id="achContent" class="modal-body"></div>
      <div class="modal-actions"><button onclick="closeAchievements()" class="secondary">Close</button></div>
    </div>
  </div>

  <div id="creditsModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Credits</h3>
      <div class="modal-body">
        <p><strong>Created by:</strong> Jeremy Frith</p>
        <p><strong>Development Assistance:</strong> GPT-5 Thinking mini</p>
        <p class="small muted">Phase 11 â€” Echoes of the Forgotten</p>
      </div>
      <div class="modal-actions"><button id="closeCredits" class="secondary">Close</button></div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    (function(){
      const overlay = document.getElementById('seedOverlay');
      const app = document.getElementById('app');
      const seedInput = document.getElementById('seedInput');
      const clsSelect = document.getElementById('classSelect');
      document.getElementById('btnStartSeed').onclick = ()=> {
        const s = seedInput.value.trim() || String(Math.floor(Math.random()*900000 + 100000));
        const cls = clsSelect.value || 'Warrior';
        startWithSeed(s, cls);
      };
      document.getElementById('btnRandomSeed').onclick = ()=> {
        const s = String(Math.floor(Math.random()*900000 + 100000));
        seedInput.value = s;
        startWithSeed(s, clsSelect.value || 'Warrior');
      };
      document.getElementById('btnDailySeed').onclick = ()=> {
        const s = window.generateDailySeed();
        seedInput.value = s;
        startWithSeed(s, clsSelect.value || 'Warrior');
      };
      function startWithSeed(s, cls){
        window.INIT_SEED = s;
        if(document.getElementById('seedDisplay')) document.getElementById('seedDisplay').innerText = s;
        overlay.classList.add('hidden');
        setTimeout(()=> overlay.style.display='none', 450);
        app.setAttribute('aria-hidden','false');
        if(window.gameInit) window.gameInit(s, cls);
      }
      if(window.INIT_SEED){ overlay.style.display = 'none'; app.setAttribute('aria-hidden','false'); }
    })();
  </script>
</body>
</html>
