<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Dungeons in the Margins â€” Legacy of Ash</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Seed overlay (mystical intro) -->
  <div id="seedOverlay" class="seed-overlay" role="dialog" aria-modal="true">
    <div class="seed-card">
      <h2>ðŸœ‚ The Fates Await</h2>
      <p class="muted">Speak the number that will shape your descent â€” share it with others to replay the same dungeon.</p>
      <input id="seedInput" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Enter a seed (digits) or leave blank" />
      <div class="seed-controls">
        <button id="btnStartSeed" class="accent">Begin Fate</button>
        <button id="btnRandomSeed" class="secondary">Random Seed</button>
      </div>
      <div class="small muted" style="margin-top:8px">Seed will appear in the UI so you can copy/share it.</div>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="wrap" aria-hidden="true">
    <header class="topbar">
      <div>
        <h1>ðŸœ‚ Dungeons in the Margins</h1>
        <div class="subtitle">Dark Gothic â€” Legacy of Ash</div>
      </div>
      <div class="top-actions">
        <div class="small muted">Seed: <span id="seedDisplay">â€”</span></div>
        <div class="small muted">Fragments: <span id="fragments">0</span></div>
        <button id="btnMeta" class="secondary">Meta Shop</button>
        <button id="btnNew" class="secondary">New Run</button>
        <button id="btnReset" class="warn">Reset Save</button>
      </div>
    </header>

    <main class="layout">
      <aside class="panel left">
        <section class="panel-block">
          <div class="section-title">Player</div>
          <div id="playerCard" class="player-card">
            <div id="playerName" class="player-name">â€”</div>
            <div id="playerClass" class="small muted">Choose a class to start</div>
            <div class="equip-list muted">
              <div>Weapon: <span id="slotWeapon">None</span></div>
              <div>Armor: <span id="slotArmor">None</span></div>
              <div>Accessory: <span id="slotAccessory">None</span></div>
            </div>
            <div class="relic-row small muted" id="relicRow">Relics: â€”</div>
            <div class="small muted" id="alignmentLabel">Alignment: Neutral</div>
          </div>
        </section>

        <section class="panel-block">
          <div class="section-title">Stats</div>
          <div class="stats-grid">
            <div class="stat">HP <span id="hp">0</span>/<span id="maxhp">0</span></div>
            <div class="stat">MP <span id="mp">0</span>/<span id="maxmp">0</span></div>
            <div class="stat">ATK <span id="atk">0</span></div>
            <div class="stat">DEF <span id="def">0</span></div>
            <div class="stat">MAG <span id="mag">0</span></div>
            <div class="stat">Floor <span id="floor">0</span></div>
            <div class="stat">Gold <span id="gold">0</span></div>
            <div class="stat">XP <span id="xp">0</span></div>
          </div>
        </section>

        <section class="panel-block">
          <div class="section-title">Quick</div>
          <div class="controls">
            <button id="btnEnterRoom">Enter Room</button>
            <button id="btnShop">Shop</button>
            <button id="btnRest" class="secondary">Rest (5g)</button>
            <button id="btnInventory" class="secondary">Inventory</button>
            <button id="btnJournal" class="secondary">Journal</button>
            <button id="btnLeaderboard" class="secondary">Leaderboard</button>
          </div>
        </section>

        <section class="panel-block">
          <div class="small muted">Inventory summary</div>
          <div class="small" id="invSummary">Potions: 0 â€¢ Ethers: 0 â€¢ Items: 0</div>
          <div style="margin-top:8px"><button id="btnExport" class="secondary">Export Log</button></div>
        </section>
      </aside>

      <section class="panel right">
        <div class="panel-block">
          <div class="section-title">Encounter</div>
          <div id="encounterBox" class="encounter">
            <div id="encounterTitle" class="encounter-title">Welcome</div>
            <div id="encounterText" class="muted">Start a run or choose a class.</div>

            <div id="combatUI" class="combat-ui hidden">
              <div class="enemy-panel">
                <div id="enemyName" class="enemy-name">â€”</div>
                <div class="small muted">HP: <span id="enemyHP">0</span> â€¢ ATK: <span id="enemyATK">0</span></div>
                <div class="small muted">Status: <span id="enemyStatus">â€”</span></div>
              </div>

              <div class="combat-actions">
                <button id="btnAttack">Attack</button>
                <button id="btnSpell" class="secondary">Spell</button>
                <button id="btnItem" class="secondary">Item</button>
                <button id="btnRun" class="warn">Run</button>
              </div>

              <div id="spellMenu" class="spell-menu hidden">
                <div class="small muted">Spells (MP)</div>
                <div class="spell-row" id="spellRow"></div>
                <div style="margin-top:8px"><button id="btnSpellBack" class="secondary">Back</button></div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel-block">
          <div class="section-title">Shop / Events</div>
          <div id="shopPanel" class="shop-panel muted">Merchants and events will appear while exploring.</div>
        </div>

        <div class="panel-block">
          <div class="section-title">Log</div>
          <div id="log" class="log" aria-live="polite"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Save toast -->
  <div id="saveToast" class="save-toast">ðŸ’¾ Saved</div>

  <!-- Cinematic overlay -->
  <div id="cineOverlay" class="cine-overlay hidden" aria-hidden="true">
    <div id="cineText" class="cine-text"></div>
    <div id="cineBlood" class="blood-runic"></div>
  </div>

  <!-- Modal Panes -->
  <div id="metaModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Meta Shop â€” Spend Soul Fragments</h3>
      <div id="metaContent" class="modal-body"></div>
      <div class="modal-actions">
        <button onclick="closeMeta()" class="secondary">Close</button>
      </div>
    </div>
  </div>

  <div id="journalModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Journal</h3>
      <div id="journalContent" class="modal-body"></div>
      <div class="modal-actions"><button onclick="closeJournal()" class="secondary">Close</button></div>
    </div>
  </div>

  <div id="summaryModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3>Run Summary</h3>
      <div id="summaryContent" class="modal-body"></div>
      <div class="modal-actions">
        <button id="btnCopySeed" class="secondary">Copy Seed Link</button>
        <button onclick="closeSummary()" class="secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Audio (placeholders, user can replace sources with real files) -->
  <audio id="bgm" loop preload="auto"></audio>
  <audio id="sfx" preload="auto"></audio>

  <script src="game.js"></script>

  <script>
    // seed overlay wiring
    (function(){
      const overlay = document.getElementById('seedOverlay');
      const app = document.getElementById('app');
      const seedInput = document.getElementById('seedInput');
      document.getElementById('btnStartSeed').onclick = ()=> {
        let s = seedInput.value.trim();
        if(s === '') { alert('Please enter numbers or press Random Seed'); return; }
        startWithSeed(s);
        overlay.style.display = 'none'; app.setAttribute('aria-hidden','false');
      };
      document.getElementById('btnRandomSeed').onclick = ()=> {
        const s = String(Math.floor(Math.random()*900000 + 100000));
        seedInput.value = s;
        startWithSeed(s);
        overlay.style.display = 'none'; app.setAttribute('aria-hidden','false');
      };
      function startWithSeed(s){
        window.INIT_SEED = s;
        if($('seedDisplay')) $('seedDisplay').innerText = s;
        if(window.gameInit) window.gameInit(s);
      }
      if(window.INIT_SEED){ overlay.style.display = 'none'; app.setAttribute('aria-hidden','false'); }
    })();
  </script>
</body>
</html>
